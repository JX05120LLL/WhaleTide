{"ast":null,"code":"import { onMounted } from 'vue';\nimport { useStore } from 'vuex';\nexport default {\n  setup: function setup() {\n    var store = useStore();\n    onMounted(function () {\n      // 如果已有token则自动获取用户信息\n      var token = localStorage.getItem('token');\n      if (token) {\n        console.log('App.vue: 检测到token存在，准备获取用户信息');\n        console.log('当前token:', token);\n        store.dispatch('getUserInfo').then(function (userInfo) {\n          console.log('用户信息获取成功:', userInfo);\n        })[\"catch\"](function (error) {\n          console.error('自动获取用户信息失败:', error);\n          // 如果token无效，自动清除\n          if (error.message && error.message.includes('登录已过期')) {\n            console.log('清除无效token');\n            localStorage.removeItem('token');\n            store.commit('logout');\n          }\n        });\n      } else {\n        console.log('App.vue: 未检测到token');\n      }\n    });\n  }\n};","map":{"version":3,"names":["onMounted","useStore","setup","store","token","localStorage","getItem","console","log","dispatch","then","userInfo","error","message","includes","removeItem","commit"],"sources":["D:\\code\\project\\WhaleTide-1\\WhaleTide\\wt-client-web\\src\\App.vue"],"sourcesContent":["<template>\r\n  <router-view />\r\n</template>\r\n\r\n<script>\r\nimport { onMounted } from 'vue'\r\nimport { useStore } from 'vuex'\r\n\r\nexport default {\r\n  setup() {\r\n    const store = useStore()\r\n    \r\n    onMounted(() => {\r\n      // 如果已有token则自动获取用户信息\r\n      const token = localStorage.getItem('token')\r\n      if (token) {\r\n        console.log('App.vue: 检测到token存在，准备获取用户信息')\r\n        console.log('当前token:', token)\r\n        \r\n        store.dispatch('getUserInfo')\r\n          .then(userInfo => {\r\n            console.log('用户信息获取成功:', userInfo)\r\n          })\r\n          .catch(error => {\r\n            console.error('自动获取用户信息失败:', error)\r\n            // 如果token无效，自动清除\r\n            if (error.message && error.message.includes('登录已过期')) {\r\n              console.log('清除无效token')\r\n              localStorage.removeItem('token')\r\n              store.commit('logout')\r\n            }\r\n          })\r\n      } else {\r\n        console.log('App.vue: 未检测到token')\r\n      }\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n* {\r\n  margin: 0;\r\n  padding: 0;\r\n  box-sizing: border-box;\r\n  font-family: \"PingFang SC\", \"Microsoft YaHei\", sans-serif;\r\n}\r\n\r\nbody {\r\n  background-color: #f5f5f5;\r\n  color: #333;\r\n}\r\n\r\na {\r\n  text-decoration: none;\r\n  color: inherit;\r\n}\r\n\r\n.container {\r\n  width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n/* 修改Element Plus默认样式 */\r\n.el-button--primary {\r\n  background-color: #0078d7;\r\n}\r\n\r\n/* 通用样式 */\r\n.text-center {\r\n  text-align: center;\r\n}\r\n\r\n.mt-3 {\r\n  margin-top: 15px;\r\n}\r\n\r\n.mb-3 {\r\n  margin-bottom: 15px;\r\n}\r\n</style> "],"mappings":"AAKA,SAASA,SAAQ,QAAS,KAAI;AAC9B,SAASC,QAAO,QAAS,MAAK;AAE9B,eAAe;EACbC,KAAK,WAALA,KAAKA,CAAA,EAAG;IACN,IAAMC,KAAI,GAAIF,QAAQ,CAAC;IAEvBD,SAAS,CAAC,YAAM;MACd;MACA,IAAMI,KAAI,GAAIC,YAAY,CAACC,OAAO,CAAC,OAAO;MAC1C,IAAIF,KAAK,EAAE;QACTG,OAAO,CAACC,GAAG,CAAC,8BAA8B;QAC1CD,OAAO,CAACC,GAAG,CAAC,UAAU,EAAEJ,KAAK;QAE7BD,KAAK,CAACM,QAAQ,CAAC,aAAa,EACzBC,IAAI,CAAC,UAAAC,QAAO,EAAK;UAChBJ,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEG,QAAQ;QACnC,CAAC,UACK,CAAC,UAAAC,KAAI,EAAK;UACdL,OAAO,CAACK,KAAK,CAAC,aAAa,EAAEA,KAAK;UAClC;UACA,IAAIA,KAAK,CAACC,OAAM,IAAKD,KAAK,CAACC,OAAO,CAACC,QAAQ,CAAC,OAAO,CAAC,EAAE;YACpDP,OAAO,CAACC,GAAG,CAAC,WAAW;YACvBH,YAAY,CAACU,UAAU,CAAC,OAAO;YAC/BZ,KAAK,CAACa,MAAM,CAAC,QAAQ;UACvB;QACF,CAAC;MACL,OAAO;QACLT,OAAO,CAACC,GAAG,CAAC,oBAAoB;MAClC;IACF,CAAC;EACH;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}