{"remainingRequest":"D:\\MyFile\\NewProject\\ghost-m-admin-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\MyFile\\NewProject\\ghost-m-admin-web\\src\\views\\activity\\Add.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\MyFile\\NewProject\\ghost-m-admin-web\\src\\views\\activity\\Add.vue","mtime":1746509703000},{"path":"D:\\MyFile\\NewProject\\ghost-m-admin-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1747114800727},{"path":"D:\\MyFile\\NewProject\\ghost-m-admin-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1747114801239},{"path":"D:\\MyFile\\NewProject\\ghost-m-admin-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1747114800727},{"path":"D:\\MyFile\\NewProject\\ghost-m-admin-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1747114801604}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IGNyZWF0ZUFjdGl2aXR5IH0gZnJvbSAnQC9hcGkvYWN0aXZpdHknCmltcG9ydCB7IGZvcm1hdFRpbWUgfSBmcm9tICdAL3V0aWxzJwppbXBvcnQgVXBsb2FkSW1hZ2UgZnJvbSAnQC9jb21wb25lbnRzL2NvbW1vbi9VcGxvYWRJbWFnZScKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQWN0aXZpdHlBZGQnLAogIGNvbXBvbmVudHM6IHsKICAgIFVwbG9hZEltYWdlCiAgfSwKICBkYXRhKCkgewogICAgLy8g6aqM6K+B57uT5p2f5pe26Ze05aSn5LqO5byA5aeL5pe26Ze0CiAgICBjb25zdCB2YWxpZGF0ZUVuZFRpbWUgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgIGlmICh2YWx1ZSAmJiB0aGlzLmFjdGl2aXR5Rm9ybS5zdGFydFRpbWUpIHsKICAgICAgICBpZiAodmFsdWUgPD0gdGhpcy5hY3Rpdml0eUZvcm0uc3RhcnRUaW1lKSB7CiAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ+e7k+adn+aXtumXtOW/hemhu+Wkp+S6juW8gOWni+aXtumXtCcpKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjYWxsYmFjaygpCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrKCkKICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gewogICAgICBhY3Rpdml0eUZvcm06IHsKICAgICAgICB0aXRsZTogJycsCiAgICAgICAgY29udGVudDogJycsCiAgICAgICAgbG9jYXRpb246ICcnLAogICAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUobmV3IERhdGUoKS5nZXRUaW1lKCkgKyAzNjAwMDAwKSwgLy8g6buY6K6kMeWwj+aXtuWQjuW8gOWniwogICAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgNzIwMDAwMCksIC8vIOm7mOiupDLlsI/ml7blkI7nu5PmnZ8KICAgICAgICBtYXhQYXJ0aWNpcGFudHM6IDMwLAogICAgICAgIHN0YXR1czogMSwgLy8g6buY6K6k5Li66L+b6KGM5LitCiAgICAgICAgaW1hZ2U6ICcnLAogICAgICB9LAogICAgICBzdGF0dXNPcHRpb25zOiBbCiAgICAgICAgeyB2YWx1ZTogMCwgbGFiZWw6ICflt7Lnu5PmnZ8nIH0sCiAgICAgICAgeyB2YWx1ZTogMSwgbGFiZWw6ICfov5vooYzkuK0nIH0sCiAgICAgICAgeyB2YWx1ZTogMiwgbGFiZWw6ICfmnKrlvIDlp4snIH0KICAgICAgXSwKICAgICAgcnVsZXM6IHsKICAgICAgICB0aXRsZTogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpea0u+WKqOWQjeensCcsIHRyaWdnZXI6ICdibHVyJyB9LAogICAgICAgICAgeyBtaW46IDIsIG1heDogNTAsIG1lc3NhZ2U6ICfplb/luqblnKggMiDliLAgNTAg5Liq5a2X56ymJywgdHJpZ2dlcjogJ2JsdXInIH0KICAgICAgICBdLAogICAgICAgIGxvY2F0aW9uOiBbCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl5rS75Yqo5Zyw54K5JywgdHJpZ2dlcjogJ2JsdXInIH0KICAgICAgICBdLAogICAgICAgIHN0YXJ0VGltZTogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+mAieaLqeW8gOWni+aXtumXtCcsIHRyaWdnZXI6ICdjaGFuZ2UnIH0KICAgICAgICBdLAogICAgICAgIGVuZFRpbWU6IFsKICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fpgInmi6nnu5PmnZ/ml7bpl7QnLCB0cmlnZ2VyOiAnY2hhbmdlJyB9LAogICAgICAgICAgeyB2YWxpZGF0b3I6IHZhbGlkYXRlRW5kVGltZSwgdHJpZ2dlcjogJ2NoYW5nZScgfQogICAgICAgIF0sCiAgICAgICAgbWF4UGFydGljaXBhbnRzOiBbCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36K6+572u5Lq65pWw6ZmQ5Yi2JywgdHJpZ2dlcjogJ2JsdXInIH0sCiAgICAgICAgICB7IHR5cGU6ICdudW1iZXInLCBtZXNzYWdlOiAn5Lq65pWw5b+F6aG75Li65pWw5a2X5YC8JywgdHJpZ2dlcjogJ2JsdXInIH0KICAgICAgICBdLAogICAgICAgIGNvbnRlbnQ6IFsKICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXmtLvliqjmj4/ov7AnLCB0cmlnZ2VyOiAnYmx1cicgfSwKICAgICAgICAgIHsgbWluOiAxMCwgbWVzc2FnZTogJ+aPj+i/sOS4jeiDveWwkeS6jjEw5Liq5a2X56ymJywgdHJpZ2dlcjogJ2JsdXInIH0KICAgICAgICBdLAogICAgICAgIHN0YXR1czogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+mAieaLqea0u+WKqOeKtuaAgScsIHRyaWdnZXI6ICdjaGFuZ2UnIH0KICAgICAgICBdCiAgICAgIH0sCiAgICAgIHN1Ym1pdHRpbmc6IGZhbHNlCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBzdWJtaXRGb3JtKCkgewogICAgICB0aGlzLiRyZWZzLmFjdGl2aXR5Rm9ybS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHRoaXMuc3VibWl0dGluZyA9IHRydWUKICAgICAgICAgIAogICAgICAgICAgY29uc3QgYWN0aXZpdHlEYXRhID0gewogICAgICAgICAgICAuLi50aGlzLmFjdGl2aXR5Rm9ybSwKICAgICAgICAgICAgc3RhcnRUaW1lOiBmb3JtYXRUaW1lKHRoaXMuYWN0aXZpdHlGb3JtLnN0YXJ0VGltZSksCiAgICAgICAgICAgIGVuZFRpbWU6IGZvcm1hdFRpbWUodGhpcy5hY3Rpdml0eUZvcm0uZW5kVGltZSkKICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgICAgY3JlYXRlQWN0aXZpdHkoYWN0aXZpdHlEYXRhKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgICB0aXRsZTogJ+aIkOWKnycsCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+a0u+WKqOWIm+W7uuaIkOWKnycsCiAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgICAgICAgIGR1cmF0aW9uOiAyMDAwCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIAogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnN1Ym1pdHRpbmcgPSBmYWxzZQogICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICdBY3Rpdml0eUxpc3QnCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwgMTAwMCkKICAgICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5Yib5bu65rS75Yqo5aSx6LSlOicsIGVycm9yKQogICAgICAgICAgICB0aGlzLnN1Ym1pdHRpbmcgPSBmYWxzZQogICAgICAgICAgICB0aGlzLiRub3RpZnkuZXJyb3IoewogICAgICAgICAgICAgIHRpdGxlOiAn5aSx6LSlJywKICAgICAgICAgICAgICBtZXNzYWdlOiAn5Yib5bu65rS75Yqo5aSx6LSlOiAnICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpLAogICAgICAgICAgICAgIGR1cmF0aW9uOiAzMDAwCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkKICAgIH0sCiAgICByZXNldEZvcm0oKSB7CiAgICAgIHRoaXMuJHJlZnMuYWN0aXZpdHlGb3JtLnJlc2V0RmllbGRzKCkKICAgIH0sCiAgICBnb0JhY2soKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBuYW1lOiAnQWN0aXZpdHlMaXN0JwogICAgICB9KQogICAgfSwKICAgIGhhbmRsZUNvdmVyU3VjY2VzcyhyZXMsIGZpbGUpIHsKICAgICAgaWYgKHJlcy5jb2RlID09PSAyMDApIHsKICAgICAgICB0aGlzLmFjdGl2aXR5Rm9ybS5pbWFnZSA9IHJlcy5kYXRhLnVybAogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S4iuS8oOWksei0pTogJyArIHJlcy5tZXNzYWdlKQogICAgICB9CiAgICB9LAogICAgYmVmb3JlQ292ZXJVcGxvYWQoZmlsZSkgewogICAgICBjb25zdCBpc0ltYWdlID0gZmlsZS50eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpCiAgICAgIGNvbnN0IGlzTHQyTSA9IGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0IDwgMgogICAgICAKICAgICAgaWYgKCFpc0ltYWdlKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Y+q6IO95LiK5Lyg5Zu+54mH5paH5Lu2IScpCiAgICAgIH0KICAgICAgaWYgKCFpc0x0Mk0pIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCflm77niYflpKflsI/kuI3og73otoXov4cgMk1CIScpCiAgICAgIH0KICAgICAgCiAgICAgIHJldHVybiBpc0ltYWdlICYmIGlzTHQyTQogICAgfQogIH0KfQo="},{"version":3,"sources":["Add.vue"],"names":[],"mappings":";AA8FA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Add.vue","sourceRoot":"src/views/activity","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-card class=\"form-card\">\n      <div slot=\"header\" class=\"card-header\">\n        <span>添加活动</span>\n      </div>\n      \n      <el-form \n        ref=\"activityForm\" \n        :model=\"activityForm\" \n        :rules=\"rules\" \n        label-width=\"120px\" \n        class=\"activity-form\"\n      >\n        <el-form-item label=\"活动名称\" prop=\"title\">\n          <el-input v-model=\"activityForm.title\" placeholder=\"请输入活动名称\"></el-input>\n        </el-form-item>\n        \n        <el-form-item label=\"活动封面\" prop=\"image\">\n          <upload-image v-model=\"activityForm.image\" type=\"activities\"></upload-image>\n        </el-form-item>\n        \n        <el-form-item label=\"活动地点\" prop=\"location\">\n          <el-input v-model=\"activityForm.location\" placeholder=\"请输入活动地点\"></el-input>\n        </el-form-item>\n        \n        <el-row :gutter=\"20\">\n          <el-col :span=\"12\">\n            <el-form-item label=\"开始时间\" prop=\"startTime\">\n              <el-date-picker\n                v-model=\"activityForm.startTime\"\n                type=\"datetime\"\n                placeholder=\"选择开始时间\"\n                style=\"width: 100%;\"\n              ></el-date-picker>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"结束时间\" prop=\"endTime\">\n              <el-date-picker\n                v-model=\"activityForm.endTime\"\n                type=\"datetime\"\n                placeholder=\"选择结束时间\"\n                style=\"width: 100%;\"\n              ></el-date-picker>\n            </el-form-item>\n          </el-col>\n        </el-row>\n        \n        <el-row :gutter=\"20\">\n          <el-col :span=\"12\">\n            <el-form-item label=\"人数限制\" prop=\"maxParticipants\">\n              <el-input-number \n                v-model=\"activityForm.maxParticipants\" \n                :min=\"1\" \n                :max=\"1000\"\n                style=\"width: 100%;\"\n              ></el-input-number>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"活动状态\" prop=\"status\">\n              <el-select v-model=\"activityForm.status\" placeholder=\"请选择状态\" style=\"width: 100%;\">\n                <el-option\n                  v-for=\"item in statusOptions\"\n                  :key=\"item.value\"\n                  :label=\"item.label\"\n                  :value=\"item.value\">\n                </el-option>\n              </el-select>\n            </el-form-item>\n          </el-col>\n        </el-row>\n        \n        <el-form-item label=\"活动描述\" prop=\"content\">\n          <el-input \n            type=\"textarea\" \n            v-model=\"activityForm.content\" \n            :rows=\"6\" \n            placeholder=\"请输入活动详细描述\"\n          ></el-input>\n        </el-form-item>\n        \n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm\" :loading=\"submitting\">创建活动</el-button>\n          <el-button @click=\"resetForm\">重置</el-button>\n          <el-button @click=\"goBack\">返回</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { createActivity } from '@/api/activity'\nimport { formatTime } from '@/utils'\nimport UploadImage from '@/components/common/UploadImage'\n\nexport default {\n  name: 'ActivityAdd',\n  components: {\n    UploadImage\n  },\n  data() {\n    // 验证结束时间大于开始时间\n    const validateEndTime = (rule, value, callback) => {\n      if (value && this.activityForm.startTime) {\n        if (value <= this.activityForm.startTime) {\n          callback(new Error('结束时间必须大于开始时间'))\n        } else {\n          callback()\n        }\n      } else {\n        callback()\n      }\n    }\n    \n    return {\n      activityForm: {\n        title: '',\n        content: '',\n        location: '',\n        startTime: new Date(new Date().getTime() + 3600000), // 默认1小时后开始\n        endTime: new Date(new Date().getTime() + 7200000), // 默认2小时后结束\n        maxParticipants: 30,\n        status: 1, // 默认为进行中\n        image: '',\n      },\n      statusOptions: [\n        { value: 0, label: '已结束' },\n        { value: 1, label: '进行中' },\n        { value: 2, label: '未开始' }\n      ],\n      rules: {\n        title: [\n          { required: true, message: '请输入活动名称', trigger: 'blur' },\n          { min: 2, max: 50, message: '长度在 2 到 50 个字符', trigger: 'blur' }\n        ],\n        location: [\n          { required: true, message: '请输入活动地点', trigger: 'blur' }\n        ],\n        startTime: [\n          { required: true, message: '请选择开始时间', trigger: 'change' }\n        ],\n        endTime: [\n          { required: true, message: '请选择结束时间', trigger: 'change' },\n          { validator: validateEndTime, trigger: 'change' }\n        ],\n        maxParticipants: [\n          { required: true, message: '请设置人数限制', trigger: 'blur' },\n          { type: 'number', message: '人数必须为数字值', trigger: 'blur' }\n        ],\n        content: [\n          { required: true, message: '请输入活动描述', trigger: 'blur' },\n          { min: 10, message: '描述不能少于10个字符', trigger: 'blur' }\n        ],\n        status: [\n          { required: true, message: '请选择活动状态', trigger: 'change' }\n        ]\n      },\n      submitting: false\n    }\n  },\n  methods: {\n    submitForm() {\n      this.$refs.activityForm.validate((valid) => {\n        if (valid) {\n          this.submitting = true\n          \n          const activityData = {\n            ...this.activityForm,\n            startTime: formatTime(this.activityForm.startTime),\n            endTime: formatTime(this.activityForm.endTime)\n          }\n          \n          createActivity(activityData).then(response => {\n            this.$notify({\n              title: '成功',\n              message: '活动创建成功',\n              type: 'success',\n              duration: 2000\n            })\n            \n            setTimeout(() => {\n              this.submitting = false\n              this.$router.push({\n                name: 'ActivityList'\n              })\n            }, 1000)\n          }).catch(error => {\n            console.error('创建活动失败:', error)\n            this.submitting = false\n            this.$notify.error({\n              title: '失败',\n              message: '创建活动失败: ' + (error.message || '未知错误'),\n              duration: 3000\n            })\n          })\n        }\n      })\n    },\n    resetForm() {\n      this.$refs.activityForm.resetFields()\n    },\n    goBack() {\n      this.$router.push({\n        name: 'ActivityList'\n      })\n    },\n    handleCoverSuccess(res, file) {\n      if (res.code === 200) {\n        this.activityForm.image = res.data.url\n      } else {\n        this.$message.error('上传失败: ' + res.message)\n      }\n    },\n    beforeCoverUpload(file) {\n      const isImage = file.type.startsWith('image/')\n      const isLt2M = file.size / 1024 / 1024 < 2\n      \n      if (!isImage) {\n        this.$message.error('只能上传图片文件!')\n      }\n      if (!isLt2M) {\n        this.$message.error('图片大小不能超过 2MB!')\n      }\n      \n      return isImage && isLt2M\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.app-container {\n  padding: 20px;\n}\n\n.form-card {\n  margin-bottom: 20px;\n  \n  .card-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n}\n\n.activity-form {\n  margin-top: 20px;\n  \n  .el-input-number {\n    width: 100%;\n  }\n}\n\n.avatar-uploader {\n  .el-upload {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n    \n    &:hover {\n      border-color: #409EFF;\n    }\n  }\n  \n  .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 178px;\n    height: 178px;\n    line-height: 178px;\n    text-align: center;\n  }\n  \n  .avatar {\n    width: 178px;\n    height: 178px;\n    display: block;\n  }\n}\n\n.input-new-tag {\n  width: 90px;\n  margin-left: 10px;\n  vertical-align: bottom;\n}\n\n.button-new-tag {\n  margin-left: 10px;\n  height: 32px;\n  line-height: 30px;\n  padding-top: 0;\n  padding-bottom: 0;\n}\n\n.el-tag {\n  margin-right: 10px;\n  margin-bottom: 5px;\n}\n</style> "]}]}